<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fullscreen Logging Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .log {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #4CAF50;
            background: #2a2a2a;
        }
        .error {
            border-left-color: #f44336;
            background: #3a2a2a;
        }
        .warning {
            border-left-color: #ff9800;
            background: #3a3a2a;
        }
    </style>
</head>
<body>
    <h1>üîç Fullscreen Logging Test</h1>
    <div id="logs"></div>

    <script>
        // Mock Telegram WebApp for testing
        window.Telegram = {
            WebApp: {
                ready: () => {
                    addLog('Telegram WebApp initialized successfully');
                },
                expand: () => {
                    addLog('Telegram WebApp expanded to fullscreen');
                },
                isExpanded: true, // Test with true initially
                onEvent: (event, callback) => {
                    if (event === 'viewportChanged') {
                        // Simulate viewport change after 1 second
                        setTimeout(() => {
                            window.Telegram.WebApp.isExpanded = false;
                            callback();
                            setTimeout(() => {
                                window.Telegram.WebApp.isExpanded = true;
                                callback();
                            }, 1000);
                        }, 1000);
                    }
                }
            }
        };

        function addLog(message, type = 'log') {
            const logsDiv = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsDiv.appendChild(logDiv);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        // Original console methods backup
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error
        };

        // Override console methods to capture logs
        console.log = (...args) => {
            originalConsole.log(...args);
            addLog(args.join(' '), 'log');
        };

        console.warn = (...args) => {
            originalConsole.warn(...args);
            addLog(args.join(' '), 'warning');
        };

        console.error = (...args) => {
            originalConsole.error(...args);
            addLog(args.join(' '), 'error');
        };

        // Simulate the Telegram WebApp initialization logic from App.tsx
        function simulateTelegramInit() {
            addLog('Telegram environment detected, initializing WebApp...');

            try {
                if (window.Telegram?.WebApp?.ready) {
                    window.Telegram.WebApp.ready();
                }

                setTimeout(() => {
                    try {
                        if (window.Telegram?.WebApp?.expand) {
                            window.Telegram.WebApp.expand();
                        } else {
                            addLog('Expand method not available', 'warning');
                        }
                    } catch (expandError) {
                        addLog('Error expanding WebApp: ' + expandError, 'error');
                    }
                }, 100);

                // Enhanced logging for fullscreen mode status (our new code)
                setTimeout(() => {
                    try {
                        const isExpanded = window.Telegram?.WebApp?.isExpanded;
                        console.log('üîç FULLSCREEN MODE STATUS CHECK:', {
                            isExpanded,
                            mode: isExpanded ? 'FULLSCREEN' : 'WINDOWED',
                            timestamp: new Date().toISOString(),
                            webAppAvailable: !!window.Telegram?.WebApp,
                            expandAvailable: !!window.Telegram?.WebApp?.expand,
                            isExpandedAvailable: !!window.Telegram?.WebApp?.isExpanded
                        });

                        if (window.Telegram?.WebApp?.onEvent) {
                            window.Telegram.WebApp.onEvent('viewportChanged', () => {
                                const newIsExpanded = window.Telegram?.WebApp?.isExpanded;
                                console.log('üîÑ FULLSCREEN MODE CHANGED:', {
                                    isExpanded: newIsExpanded,
                                    mode: newIsExpanded ? 'FULLSCREEN' : 'WINDOWED',
                                    timestamp: new Date().toISOString()
                                });
                            });
                            addLog('‚úÖ Viewport change listener registered');
                        } else {
                            addLog('‚ùå onEvent method not available for viewport changes', 'warning');
                        }
                    } catch (statusError) {
                        addLog('Error checking fullscreen status: ' + statusError, 'error');
                    }
                }, 200);

            } catch (error) {
                addLog('Error initializing Telegram WebApp: ' + error, 'error');
            }
        }

        // Start simulation
        setTimeout(simulateTelegramInit, 1000);
    </script>
</body>
</html>
