# Объяснение: Redsys vs Telegram Stars

## Два типа платежей в Telegram Bot API

Telegram Bot API поддерживает **два разных типа платежей**:

### 1. Физические товары (Physical Goods)
- Требуют **провайдера платежей** (Redsys, Stripe, и др.)
- Используют обычные валюты (USD, EUR, RUB и т.д.)
- Требуют адрес доставки от пользователя
- Имеют тестовый режим через провайдера (Redsys Test, Stripe Test Mode)

### 2. Цифровые товары (Digital Goods) - Telegram Stars
- **НЕ требуют провайдера платежей**
- Используют только валюту **XTR (Telegram Stars)**
- Не требуют адреса доставки
- **НЕ имеют тестового режима** через провайдеров

## Что такое Redsys?

**Redsys** - это провайдер платежей для **физических товаров**. Он используется когда:
- Вы продаёте физические товары (доставка требуется)
- Используете обычные валюты (EUR, USD и т.д.)
- Нужен тестовый режим для физических товаров

### Redsys Test vs Redsys Live

- **Redsys Test** - тестовый режим для физических товаров (тестовые карты)
- **Redsys Live** - продакшен режим для физических товаров (реальные карты)

**⚠️ Важно:** Эти настройки **НЕ влияют** на Telegram Stars платежи!

## Telegram Stars (XTR) - цифровые товары

Для Telegram Stars:
- ✅ **НЕ нужен провайдер** (Redsys, Stripe и т.д.)
- ✅ Используется `provider_token: ""` (пустая строка)
- ✅ Валюта: `XTR` (Telegram Stars)
- ❌ **НЕТ тестового режима** через провайдеров
- ❌ Все платежи реальные (пользователь тратит реальные Stars)

## Как это работает в коде

В нашем коде (`telegram-bot-api.ts`):

```typescript
export async function createInvoiceLink(
  botToken: string,
  params: CreateInvoiceLinkParams
): Promise<string> {
  const response = await fetch(`${BOT_API_BASE}${botToken}/createInvoiceLink`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      ...params,
      provider_token: '', // ← Пустая строка для цифровых товаров (Stars)
    })
  });
  // ...
}
```

**Ключевой момент:** `provider_token: ''` - это означает, что мы используем Telegram Stars, а не провайдера платежей.

## Настройки в @BotFather

Когда вы настраиваете бота через @BotFather:

### Для физических товаров:
1. `/mybots` → Ваш бот → Payments
2. Выбираете провайдера (Redsys, Stripe и т.д.)
3. Подключаете Test или Live режим
4. Получаете `provider_token` для использования в API

### Для цифровых товаров (Stars):
1. **НЕ нужно** настраивать провайдера
2. **НЕ нужно** подключать Redsys Test/Live
3. Просто используете `provider_token: ""` и `currency: "XTR"`

## Почему вы видите Redsys в настройках?

Если вы видите Redsys в настройках бота, это означает:
- Бот настроен для **физических товаров** (или был настроен ранее)
- Эти настройки **не мешают** использованию Telegram Stars
- Можно использовать оба типа платежей в одном боте

## Что делать для Telegram Stars?

**Ничего дополнительного настраивать не нужно!**

1. ✅ Убедитесь, что в коде используется `provider_token: ""`
2. ✅ Убедитесь, что валюта `XTR`
3. ✅ Используйте тестового бота (из `TELEGRAM_TEST_BOT_IDS`) - автоматически цена будет 1 Star
4. ✅ Используйте тестового бота через `TELEGRAM_TEST_BOT_IDS` для изоляции

## Итог

| Параметр | Физические товары | Telegram Stars |
|----------|-------------------|----------------|
| Провайдер | Redsys, Stripe и др. | Не нужен |
| `provider_token` | Токен от провайдера | `""` (пустая строка) |
| Валюта | USD, EUR, RUB и т.д. | XTR (Telegram Stars) |
| Тестовый режим | Через провайдера (Redsys Test) | Нет (все платежи реальные) |
| Адрес доставки | Требуется | Не требуется |

**Вывод:** Настройки Redsys Test/Live в @BotFather **не влияют** на Telegram Stars платежи. Для Stars не нужен провайдер, и все платежи реальные (нет тестового режима через провайдеров).
